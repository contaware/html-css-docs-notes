<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSS variables</title>
    <style>
        /* For "CSS variables basics" section */
        :root {
            /* A common practice is to define CSS variables in the :root,
               so that they can be referenced globally. */
            --div-background-color: lightsalmon;
        }
        body {
            /* The second parameter is the fallback value in case that the 
               variable is not set. */
            color: var(--text-color, darkslateblue);
            background-color: var(--background-color, whitesmoke);
        }
        .one {
            /* Overwrite the value set in :root, from now on, and in all
               descendants, --div-background-color will have this value. */
            --div-background-color: lightblue;
        }
        .child {
            /* A CSS variable inherits the value of its parent. */
            background-color: var(--div-background-color);
            margin: 10px;
        }

        /* For last point of "Advanced topics" section */
        div#grandparent {
            width: fit-content;
            --c: orange;
        }
        div#parent {
            --c: lightgreen;
            --txt: var(--c);
        }
        div#child {
            --c: aqua;
        }
        div.all {
            font-size: 1.5rem;
            text-shadow:	-0.03rem 0 black,
                            0 0.03rem black,
                            0.03rem 0 black,
                            0 -0.03rem black;
            padding-left: 20px;
            color: var(--txt, pink);
            background-color: var(--c, grey);
        }
    </style>
</head>
<body>
    <h2>CSS variables basics</h2>
    
    <p>A CSS variable (also called CSS custom property) begins with two dashes and is followed by a case-sensitive name. A custom property is referenced with the <strong><code>var()</code></strong> function which has an optional second parameter holding a fallback value used when the custom property is not set. A HTML child element inherits the CSS variables from its parent.</p>

    <p>Go to the HTML code and read the comments under the <code>&lt;style&gt;</code> tag to understand the following example:</p>
    
    <div class="one">
        <div class="child">1.1</div>
        <div class="child">1.2</div>
        <div class="child">1.3</div>
    </div>
    <div class="two">
        <div class="child">2.1</div>
        <div class="child">2.2</div>
    </div>
    <br>
    <button id="dark-theme-btn">Dark Theme</button>
    <button id="light-theme-btn">Light Theme</button>
    <button id="remove-theme-btn">Var Defaults</button>
    <button id="console-log-btn">console.log()</button>
    
    <script>
        /* document.documentElement points to the html element which is 
           also the :root pseudo-class */
        const rootElement = document.documentElement;
        const divOne = document.querySelector('.one');

        document.getElementById('dark-theme-btn').addEventListener('click', () => {
            rootElement.style.setProperty('--text-color', 'white');
            rootElement.style.setProperty('--background-color', 'black');
        })
        
        document.getElementById('light-theme-btn').addEventListener('click', () => {
            rootElement.style.setProperty('--text-color', 'black');
            rootElement.style.setProperty('--background-color', 'white');
        })
        
        document.getElementById('remove-theme-btn').addEventListener('click', () => {
            rootElement.style.removeProperty('--text-color');
            rootElement.style.removeProperty('--background-color');
        })

        document.getElementById('console-log-btn').addEventListener('click', () => {
            const txtAtRoot = window.getComputedStyle(rootElement).getPropertyValue('--text-color');
            console.log('--text-color @ :root is:           ' + txtAtRoot);

            const bkgAtRoot = window.getComputedStyle(rootElement).getPropertyValue('--background-color');
            console.log('--background-color @ :root is:     ' + bkgAtRoot);

            const divBkgAtRoot = window.getComputedStyle(rootElement).getPropertyValue('--div-background-color');
            console.log('--div-background-color @ :root is: ' + divBkgAtRoot);

            const divBkgAtOne = window.getComputedStyle(divOne).getPropertyValue('--div-background-color');
            console.log('--div-background-color @ .one is:  ' + divBkgAtOne);
        })
    </script>

    <h2>calc() and if()</h2>

    <p>The <strong><code>calc()</code></strong> function is often used in combination with CSS variables, it supports the <code>+ - * /</code> operators, just remember to <strong>surround the operators by spaces</strong>. The operands of <strong><code>+</code></strong> and <strong><code>-</code></strong> can have different units, for the <strong><code>*</code></strong> operator only one operand can contain a unit and the <strong><code>/</code></strong> operator allows units for both operands, provided they are of the same data type.</p>
    <p>Before the introduction of the <code>if()</code> function conditional styling was performed through <code>calc()</code>:</p>
<pre>
--is-big: 1; /* set to 1 or 0 */
padding: calc(25px * var(--is-big) + 10px * (1 - var(--is-big)));
</pre>
    <p>With the <code>if()</code> function it's done like:</p>
<pre>
--is-big: 1; /* set to 1 or something else */
padding: if(style(--is-big: 1): 25px; else: 10px);
</pre>

    <h2>Advanced topics</h2>
    
    <ol>
        <li>
            <p>Within a hierarchy level, the custom property assignments placed last, win, and those in tags win over all the others (yes, custom property assignments and use can happen in HTML style attributes). A custom property before being used in a <code>var()</code> function has already resolved to the highest priority value, for example the following is perfectly valid and will set the <code>padding</code> to <code>8px</code>:</p>
            <pre>
--p: 10px;
padding: calc(var(--p) + 3px);
--p: 5px;
            </pre>
        </li>
        
        <li>
            <p>The <code>var()</code> function can be used in place of any part of a property value. But the <code>var()</code> function cannot be used as property name or selector. There are some particularities to be aware of:</p>
            <pre>
--gap: 5;
--top-bottom: 5px; 
--left-right: 10px;

/* Correct */
margin: var(--top-bottom) var(--left-right);

/* Wrong */
margin-top: var(--gap)px;

/* Correct */
margin-top: calc(var(--gap) * 1px);
            </pre>
        </li>
        
        <li>
            <p>If there is a <a href="https://www.w3.org/TR/css-variables-1/#cycles" target="_blank">cycle</a> in the dependency graph of the custom properties, all the custom properties in the cycle get an invalid value assigned. A custom property referring to itself creates a cyclic dependency and thus is <strong>invalid</strong>:</p>
            <pre>
--p: 5px;
--p: calc(var(--p) + 1px);
            </pre>
            <p>A variables swap creates a cyclic dependency and thus is <strong>invalid</strong>:</p>
            <pre>
--x: 5px;
--y: 10px;
--temp: var(--y);
--y: var(--x);
--x: var(--temp);
            </pre>
        </li>

        <li>
            <p>When exiting a hierarchy level all the custom property values containing a <code>var()</code> function have been evaluated. Thus the custom properties are passed down to the next hierarchy level without any <code>var()</code> functions in their values:</p>
            <div id="grandparent" class="all">
                id="grandparent"
                <div id="parent" class="all">
                    id="parent"
                    <div id="child" class="all">
                        id="child"
                    </div>
                </div>
            </div>
            <p>Note that a <code>calc()</code> function in a custom property value is not evaluated when exiting a hierarchy level; it only gets evaluated when the custom property is assigned to a normal property.</p>
        </li>
    </ol>
</body>
</html>