<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Media Query and Fractional Pixels</title>
    <style>
        body {
            margin: 0;
            text-align: center;
            font-family: sans-serif;
            font-size: 18px;
        }
        .desc {
            text-align: left;
        }
        /*
            The older syntax with min- and max- prefixes 
            mean "minimum inclusive" and "maximum inclusive".
            That syntax suffers from the fractional width problem 
            of high DPI screens which internally can compute a width 
            of 199.5px for example.
        */
        /* Same as: width <= 199px */
        @media (max-width: 199px) {
            .hide-small {
                display: none;
            }
        }
        /* Same as: 200px <= width <= 599px */
        @media (min-width: 200px) and (max-width: 599px) {
            .hide-medium {
                display: none;
            }
        }
        /* Same as: 600px <= width */
        @media (min-width: 600px) {
            .hide-large {
                display: none;
            }
        }
        /*
            The problem is solved by using ranges with:
            <= on one side of a breakpoint and < on the other side.
        */
        @media (width < 200px) {
            .hide-small-ok {
                display: none;
            }
        }
        @media (200px <= width < 600px) {
            .hide-medium-ok {
                display: none;
            }
        }
        @media (600px <= width) {
            .hide-large-ok {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div id="display-viewport"></div>
    <br>

    <h1>Check 199px and 599px width on High DPI</h1>
    <div class="hide-medium hide-large">
    <p>Small</p>
    </div>
    <div class="hide-small hide-large">
    <p>Medium</p>
    </div>
    <div class="hide-small hide-medium">
    <p>Large</p>
    </div>
    <br>

    <h1>OK with new media query syntax</h1>
    <div class="hide-medium-ok hide-large-ok">
    <p>Small</p>
    </div>
    <div class="hide-small-ok hide-large-ok">
    <p>Medium</p>
    </div>
    <div class="hide-small-ok hide-medium-ok">
    <p>Large</p>
    </div>
    <br>

    <h2 class="desc">Mobile browsers</h2>
    <p class="desc">
        On mobile, the width media query is equal to <code>document.documentElement.clientWidth</code>.
    </p>
    <h2 class="desc">Desktop browsers</h2>
    <p class="desc">
        <ul class="desc">
        <li>On desktop, <code>document.documentElement.clientWidth</code> returns the page width excluding the vertical scrollbar width, while <code>window.innerWidth</code> includes the vertical scrollbar width (for reference: <code>document.documentElement.clientHeight</code> returns the page height excluding the horizontal scrollbar height, while <code>window.innerHeight</code> includes the horizontal scrollbar height).</li>
        <li>For most desktop browsers the width media query corresponds to <code>window.innerWidth</code>, except the WebKit-based browsers for which the width media query corresponds to <code>document.documentElement.clientWidth</code>.</li>
        <li><code>window.visualViewport.width</code> measures the same as <code>document.documentElement.clientWidth</code>, just with subpixel precision.</li>
        </ul>
    </p>
    <p class="desc">
        <a href="https://www.quirksmode.org/css/tests/mediaqueries/width.html" target="_blank">Media query width tests</a><br>
        <a href="https://bugs.webkit.org/show_bug.cgi?id=52653" target="_blank">WebKit Bugzilla entry</a><br>
        <a href="https://github.com/tailwindlabs/tailwindcss/discussions/1521" target="_blank">Tailwindcss discussion</a><br>
        <a href="https://github.com/mui/material-ui/issues/22812" target="_blank">Material-ui issue report</a>
    </p>

    <script>
        setInterval(function() {
            var msg1 = "<code>devicePixelRatio</code>: <strong>" + window.devicePixelRatio.toFixed(2) + "</strong>";
            var msg2 = "<code>innerWidth</code>: <strong>" + window.innerWidth + "px</strong>";
            var msg3 = "<code>clientWidth</code>: <strong>" + document.documentElement.clientWidth + "px</strong>";
            var msg4 = "<code>visualViewport.width</code>: <strong>" + window.visualViewport.width.toFixed(2) + "px</strong>";
            document.getElementById("display-viewport").innerHTML = msg1 + "<br>" + msg2 + "<br>" + msg3 + "<br>" + msg4;
        }, 100);
    </script>
</body>
</html>