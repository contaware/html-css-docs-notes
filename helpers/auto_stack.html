<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>auto stack</title>
    <style>
        :root {
            --width: 100%;
            --stack-breakpoint: 800px; /* it will stack when the size of the flex/grid container is less than this */
        }
        html, body {
            margin: 0;
            padding: 0;
        }
        body {
            width: 90%;
            margin: 10px auto;
            background-color: #F0F0F0;
        }

        /*
        For small devices:
        (var(--stack-breakpoint) - 100%) * 9999 -> POSITIVE 

        For desktops:
        (var(--stack-breakpoint) - 100%) * 9999 -> NEGATIVE 
        */

        .flex-auto-stack {
            --margin: 15px;
            width: calc(var(--width) + 2 * var(--margin));  /* take into account the child margins */
            margin: calc(var(--margin) * -1);               /* compensate the margins added by the childs */
            background: yellow;
            display: flex;
            flex-wrap: wrap;
            justify-content: flex-start;    /* default is flex-start */
        }
        .flex-auto-stack > * {
            flex-grow: 1;                   /* default is 0 (no grow) */
            flex-shrink: 1;                 /* default is 1 (shrink) */
            margin: var(--margin);
            padding: 15px;
            
            /*** For IE11 compatibility avoid CSS vars and use the calc() solution ***/
            
            /*
            SOLUTION 1.
            This is more intuitive and clearly shows that negative values are not to be set.
            */
            /*flex-basis: max((var(--stack-breakpoint) - 100%) * 9999, 0px);*/
            
            /*
            SOLUTION 2.
            This is the idea from https://heydonworks.com/article/the-flexbox-holy-albatross/
            which is correct but not intuitive, it works because the calc() specs tell us that a
            value resulting from an expression must be clamped to the range allowed in the target context
            (see https://www.w3.org/TR/css-values-3/#calc-range).
            flex-basis: -10000px would be invalid and cause the entire declaration to be dropped, so that
            the default flex-basis: auto would be used. auto is not what we want because the box basis
            comes then from the content.
            */
            flex-basis: calc((var(--stack-breakpoint) - 100%) * 9999);
        }

        .grid-auto-stack {
            /*width: var(--width);*/ /* not necessary, better to leave it out so that the default auto is used */
            --grid-column-gap: 30px;
            --grid-row-gap: 30px;
            grid-column-gap: var(--grid-column-gap);
            grid-row-gap: var(--grid-row-gap);
            background: yellow;
            display: grid;
            
            /* 
            SOLUTION 1A.
            This is the idea from https://blog.logrocket.com/flexible-layouts-without-media-queries/
            clamp() limits (var(--stack-breakpoint) - 100%) * 9999 and minmax(min, max) evaluates to min if min > max. 
            */
            /* grid-template-columns: repeat(auto-fit, minmax(clamp(33.3333%, (var(--stack-breakpoint) - 100%) * 9999, 100%), 1fr)); */
            
            /* 
            SOLUTION 1B.
            When adding a gap we must remove that from the minimum.
            */
            /* grid-template-columns: repeat(auto-fit, minmax(clamp(33.3333% - var(--grid-column-gap), (var(--stack-breakpoint) - 100%) * 9999, 100%), 1fr)); */

            /* 
            SOLUTION 2.
            This works with gaps and any number of columns. min() behaves like calc() in case that a 
            result is out of the range allowed by the target context 
            (see https://www.w3.org/TR/css-values-4/#calc-range). minmax() doesn't allow negative
            values, so when min() would return a negative value it is clamped to 0px.
            */
            grid-template-columns: repeat(auto-fit, minmax(min((var(--stack-breakpoint) - 100%) * 9999, 100%), 1fr));
        }
        .grid-auto-stack > * {
            padding: 15px;
        }
    </style>
</head>
<body>

    <p>Flex is more compatible but is ugly with the margins, and if the body is at 100% then the negative margins necessary for the flex container cause the scrollbars to show. If possible use grid ;-)</p>

    <h1>flex 2 items</h1>
    <div class="flex-auto-stack">
        <div style="background: pink;">DIV1<br>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged.</div>
        <div style="background: green;">DIV2</div>
    </div>

    <hr>

    <h1>grid 2 items</h1>
    <div class="grid-auto-stack">
        <div style="background: pink;">DIV1<br>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged.</div>
        <div style="background: green;">DIV2</div>
    </div>

    <hr>

    <h1>flex 3 items</h1>
    <div class="flex-auto-stack">
        <div style="background: pink;">DIV1<br>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged.</div>
        <div style="background: green;">DIV2</div>
        <div style="background: red;">DIV3</div>
    </div>

    <hr>

    <h1>grid 3 items</h1>
    <div class="grid-auto-stack">
        <div style="background: pink;">DIV1<br>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged.</div>
        <div style="background: green;">DIV2</div>
        <div style="background: red;">DIV3</div>
    </div>

    <hr>

    <h1>flex 4 items</h1>
    <div class="flex-auto-stack">
        <div style="background: pink;">DIV1<br>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged.</div>
        <div style="background: green;">DIV2</div>
        <div style="background: red;">DIV3</div>
        <div style="background: aqua;">DIV4</div>
    </div>

    <hr>

    <h1>grid 4 items</h1>
    <p>The justify-items and align-items property set the justify-self and align-self property for all of the child grid items. If omitted and no width/height are set, the child div will stretch.</p>
    <p>In rare circumstances it may be necessary to align the total size of your grid in its grid container with justify-content and align-content. This could happen if all of the grid items are sized with non-flexible units like px.</p>
    <div class="grid-auto-stack">
        <div style="background: pink;">DIV1<br>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged.</div>
        <div style="background: green; justify-self: center;">DIV2</div>
        <div style="background: red; align-self: center;">DIV3</div>
        <div style="background: aqua; justify-self: center; align-self: center;">DIV4</div>
    </div>

</body>
</html>